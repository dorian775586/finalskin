<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ -->
<div id="itemCard" class="w-full bg-slate-800 rounded-lg shadow-lg p-4 mt-4 hidden"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('searchInput');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('resultsList');
        const noResults = document.getElementById('noResults');
        const itemCard = document.getElementById('itemCard');
        let typingTimeout;

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim();
            clearTimeout(typingTimeout);

            if (query.length > 2) {
                typingTimeout = setTimeout(() => {
                    fetchResults(query);
                }, 300);
            } else {
                resultsContainer.style.display = 'none';
                resultsList.innerHTML = '';
                itemCard.classList.add('hidden');
            }
        });

        async function fetchResults(query) {
            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                    return;
                }

                displayResults(data.results);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function displayResults(results) {
            resultsList.innerHTML = '';
            if (results.length > 0) {
                results.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    li.className = 'list-item p-3 animate-in';
                    
                    // üî• –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É
                    li.addEventListener('click', () => fetchItemInfo(item));

                    resultsList.appendChild(li);
                });
                resultsContainer.style.display = 'block';
                noResults.classList.add('hidden');
            } else {
                resultsContainer.style.display = 'block';
                noResults.classList.remove('hidden');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ—ã –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É
        async function fetchItemInfo(itemName) {
            try {
                const response = await fetch(`/item?name=${encodeURIComponent(itemName)}`);
                const data = await response.json();

                if (data.error) {
                    itemCard.innerHTML = `<p class="text-red-400">–û—à–∏–±–∫–∞: ${data.error}</p>`;
                } else {
                    itemCard.innerHTML = `
                        <h2 class="text-2xl font-bold mb-2">${data.item_name}</h2>
                        <p><span class="font-semibold">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞:</span> ${data.lowest_price}</p>
                        <p><span class="font-semibold">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</span> ${data.median_price}</p>
                        <p><span class="font-semibold">–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ 24—á:</span> ${data.volume}</p>
                        <a href="${data.link}" target="_blank" 
                           class="text-blue-400 hover:underline mt-2 inline-block">–û—Ç–∫—Ä—ã—Ç—å –≤ Steam</a>
                    `;
                }

                itemCard.classList.remove('hidden');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–¥–º–µ—Ç–µ:', error);
            }
        }
    });
</script>
